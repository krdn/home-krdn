# Plan 06-02: 번들 사이즈 최적화

---
phase: 06-performance-optimization
plan: 02
type: execute
depends_on: []
files_modified:
  - src/components/admin/MetricsCharts.tsx
  - src/app/admin/page.tsx
  - next.config.ts
---

## Objective

Dynamic import와 코드 스플리팅을 적용하여 초기 로딩 성능을 개선하고 번들 사이즈를 최적화합니다.

Purpose: 초기 페이지 로드 시간 단축, 필요한 코드만 로드
Output: 최적화된 번들 구조, lazy-loaded 컴포넌트

## Execution Context

**Codebase context:**
- `recharts` 3.6.0 - 가장 큰 번들 (약 386KB)
- `lucide-react` 0.562.0 - 아이콘 라이브러리
- 차트 컴포넌트: `MetricsCharts.tsx`, `MetricsLineChart.tsx`, `NetworkAreaChart.tsx`

**Dependencies:**
- Phase 5 완료 (차트 컴포넌트 존재)

**Current bundle:**
- 가장 큰 청크: 386KB (Recharts 포함)
- 총 JS 청크: ~1MB

**Design patterns:**
- next/dynamic으로 lazy loading
- Suspense fallback UI
- 번들 분석으로 효과 측정

## Context

Phase 6: Performance Optimization의 두 번째 계획입니다.

**현재 문제:**
- Recharts가 초기 번들에 포함 (386KB)
- 차트가 필요하지 않은 페이지에서도 로드됨
- 초기 로딩 시간 증가

**최적화 전략:**
- 차트 컴포넌트 dynamic import
- loading placeholder 제공
- 필요시에만 Recharts 로드

## Tasks

### Task 1: 차트 컴포넌트 Dynamic Import 적용

**File:** `src/app/admin/page.tsx`

**Changes:**
1. MetricsCharts를 dynamic import로 변경
2. loading 상태 placeholder 추가
3. ssr: false 옵션 적용 (차트는 클라이언트 전용)

**Implementation:**
```typescript
import dynamic from 'next/dynamic';

const MetricsCharts = dynamic(
  () => import('@/components/admin/MetricsCharts').then(mod => ({ default: mod.MetricsCharts })),
  {
    loading: () => (
      <div className="grid gap-4 lg:grid-cols-2">
        {[...Array(4)].map((_, i) => (
          <div key={i} className="h-64 animate-pulse rounded-lg bg-muted" />
        ))}
      </div>
    ),
    ssr: false,
  }
);
```

**Commit:** `perf(06-02): 차트 컴포넌트 dynamic import 적용`

### Task 2: 번들 분석 스크립트 추가

**File:** `package.json`

**Changes:**
1. `analyze` 스크립트 추가
2. `@next/bundle-analyzer` 설치 (devDependencies)
3. next.config.ts에 bundle analyzer 설정

**Implementation:**
```json
{
  "scripts": {
    "analyze": "ANALYZE=true next build"
  }
}
```

```typescript
// next.config.ts
const withBundleAnalyzer = process.env.ANALYZE === 'true'
  ? require('@next/bundle-analyzer')({ enabled: true })
  : (config: any) => config;

export default withBundleAnalyzer(nextConfig);
```

**Commit:** `chore(06-02): 번들 분석 스크립트 추가`

### Task 3: 아이콘 Import 최적화 확인

**File:** 여러 컴포넌트 파일

**Changes:**
1. lucide-react import 패턴 확인 (named import 사용 중인지)
2. 필요시 개별 import로 변경
3. 사용하지 않는 아이콘 import 제거

**확인 사항:**
```typescript
// 좋은 패턴 (tree-shaking 가능)
import { Home, Settings, Container } from 'lucide-react';

// 나쁜 패턴 (전체 번들 포함)
import * as Icons from 'lucide-react';
```

**Commit:** `perf(06-02): 아이콘 import 최적화`

## Verification

```bash
# 번들 분석 실행
npm run analyze

# 빌드 후 청크 크기 확인
npm run build
ls -la .next/static/chunks/

# 개발 서버에서 네트워크 탭 확인
npm run dev
# /admin 페이지 로드 시 차트 청크가 별도로 로드되는지 확인
```

## Success Criteria

- [ ] MetricsCharts가 별도 청크로 분리됨
- [ ] 초기 번들 크기 감소 (Recharts 분리)
- [ ] 차트 로딩 중 placeholder 표시됨
- [ ] 번들 분석 스크립트 동작
- [ ] 빌드 성공

## Output

**Modified files:**
- `src/app/admin/page.tsx`
- `package.json`
- `next.config.ts`

**New scripts:**
- `npm run analyze`

**Commits:** 3 commits (per task)

---
*Created: 2026-01-14*
