# Phase 39-02: Kubernetes REST API 엔드포인트

## 목표

Kubernetes 리소스 조회를 위한 REST API 엔드포인트 구현

## 작업 항목

### 1. 클러스터 설정 API

**src/app/api/kubernetes/clusters/route.ts**:
- `GET /api/kubernetes/clusters` - 사용자의 클러스터 목록
- `POST /api/kubernetes/clusters` - 새 클러스터 추가

**src/app/api/kubernetes/clusters/[clusterId]/route.ts**:
- `GET /api/kubernetes/clusters/[clusterId]` - 클러스터 상세
- `PUT /api/kubernetes/clusters/[clusterId]` - 클러스터 수정
- `DELETE /api/kubernetes/clusters/[clusterId]` - 클러스터 삭제

**src/app/api/kubernetes/clusters/[clusterId]/test/route.ts**:
- `POST /api/kubernetes/clusters/[clusterId]/test` - 연결 테스트

### 2. 리소스 조회 API

**src/app/api/kubernetes/clusters/[clusterId]/namespaces/route.ts**:
- `GET /api/kubernetes/clusters/[clusterId]/namespaces` - 네임스페이스 목록

**src/app/api/kubernetes/clusters/[clusterId]/pods/route.ts**:
- `GET /api/kubernetes/clusters/[clusterId]/pods?namespace=xxx` - Pod 목록

**src/app/api/kubernetes/clusters/[clusterId]/services/route.ts**:
- `GET /api/kubernetes/clusters/[clusterId]/services?namespace=xxx` - Service 목록

**src/app/api/kubernetes/clusters/[clusterId]/deployments/route.ts**:
- `GET /api/kubernetes/clusters/[clusterId]/deployments?namespace=xxx` - Deployment 목록

### 3. API 응답 형식

```typescript
// 성공 응답
{
  "success": true,
  "data": { ... }
}

// 에러 응답
{
  "success": false,
  "error": "에러 메시지"
}
```

### 4. 권한 검증

모든 API는 다음을 검증:
1. 사용자 인증 (JWT)
2. 클러스터 소유권 (clusterId가 요청 사용자 소유인지)
3. RBAC (ADMIN/USER 역할)

## API 상세 명세

### GET /api/kubernetes/clusters
사용자의 모든 클러스터 목록 반환

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": "cuid",
      "name": "production-cluster",
      "server": "https://k8s.example.com:6443",
      "hasToken": true,
      "hasCertificate": false,
      "defaultNamespace": "default",
      "isActive": true
    }
  ]
}
```

### POST /api/kubernetes/clusters
새 클러스터 추가 (연결 테스트 후 저장)

**Request:**
```json
{
  "name": "production-cluster",
  "server": "https://k8s.example.com:6443",
  "caData": "base64...",
  "authType": "token",
  "token": "eyJhbG...",
  "defaultNamespace": "default"
}
```

### GET /api/kubernetes/clusters/[clusterId]/pods
특정 클러스터의 Pod 목록

**Query Params:**
- `namespace`: 네임스페이스 (기본값: 클러스터 기본 NS)

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "name": "nginx-7fb96c846b-abc12",
      "namespace": "default",
      "status": "Running",
      "phase": "Running",
      "nodeName": "node-1",
      "podIP": "10.244.0.5",
      "containers": [
        {
          "name": "nginx",
          "image": "nginx:1.21",
          "ready": true,
          "restartCount": 0
        }
      ],
      "createdAt": "2026-01-16T10:00:00Z"
    }
  ]
}
```

## 완료 조건

- [ ] 클러스터 CRUD API 구현 (5개 엔드포인트)
- [ ] 리소스 조회 API 구현 (4개 엔드포인트)
- [ ] 권한 검증 미들웨어 적용
- [ ] 빌드 에러 없음
- [ ] API 테스트 통과

## 참고

- GitHub API 구현 패턴 (`src/app/api/github/`)
- Port Registry API 패턴 (`src/app/api/ports/`)
