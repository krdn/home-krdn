---
phase: 02-code-quality
plan: 02
type: execute
depends_on: []
files_modified: [src/lib/docker.ts, src/types/docker.ts]
---

<objective>
Docker API 응답에 런타임 검증을 추가하여 타입 안전성을 강화합니다.

Purpose: `JSON.parse as T` 패턴은 런타임에 타입을 보장하지 않아 Docker API 변경 시 조용히 실패할 수 있습니다.
Output: Zod 스키마로 검증되는 안전한 Docker API 클라이언트
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/codebase/CONCERNS.md

**현재 문제점 (CONCERNS.md):**
- `JSON.parse(data) as T` assumes runtime matches types
- File: `src/lib/docker.ts` (line 64)
- Impact: Silent failures if Docker API changes
- Fix approach: Add runtime validation (zod)

**Zod 설치 여부:** 확인 필요 (package.json 체크)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Zod 설치 및 Docker 스키마 생성</name>
  <files>src/types/docker.ts</files>
  <action>
1. `npm install zod` (이미 설치되어 있으면 스킵)
2. `src/types/docker.ts` 생성 또는 수정하여 Zod 스키마 추가:
   - `ContainerInfoSchema`: id, names, image, state, status, ports, labels
   - `ContainerStatsSchema`: cpu_stats, memory_stats, networks
   - `ContainerListResponseSchema`: 배열 스키마
3. 스키마에서 TypeScript 타입 추출: `type ContainerInfo = z.infer<typeof ContainerInfoSchema>`

**주의:** Docker API의 실제 응답 구조에 맞게 스키마 작성
- /containers/json 응답: [{Id, Names, Image, State, Status, Ports, Labels, ...}]
- 필드명은 PascalCase (Docker API 규격)
  </action>
  <verify>`npx tsc --noEmit` 성공</verify>
  <done>Zod 스키마가 Docker API 응답 구조와 일치</done>
</task>

<task type="auto">
  <name>Task 2: docker.ts에 런타임 검증 적용</name>
  <files>src/lib/docker.ts</files>
  <action>
1. Zod 스키마 import: `import { ContainerListResponseSchema } from '@/types/docker';`
2. `listContainers()` 함수에서:
   - 기존: `return JSON.parse(data) as ContainerInfo[];`
   - 변경: `return ContainerListResponseSchema.parse(JSON.parse(data));`
3. 검증 실패 시 ZodError가 throw되므로 기존 try/catch에서 처리됨
4. 에러 메시지에 검증 실패 정보 포함하도록 개선 (선택)

**주의:**
- safe 파싱 사용 고려: `safeParse()`로 부분 실패 허용 가능
- 하지만 현재는 strict하게 parse() 사용 권장 (문제 조기 발견)
  </action>
  <verify>개발 서버에서 `/api/docker/containers` 호출 시 정상 응답</verify>
  <done>Docker API 응답이 런타임에 검증됨</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` 성공
- [ ] `npx tsc --noEmit` 성공
- [ ] Docker containers API가 정상 동작 (수동 테스트)
- [ ] 잘못된 응답 시 명확한 에러 발생 (선택)
</verification>

<success_criteria>

- Zod 스키마로 Docker API 응답 검증
- 타입과 런타임 값이 일치하도록 보장
- 기존 기능 정상 동작
</success_criteria>

<output>
After completion, create `.planning/phases/02-code-quality/02-02-SUMMARY.md`
</output>
