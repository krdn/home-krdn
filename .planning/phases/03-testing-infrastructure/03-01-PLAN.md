---
phase: 03-testing-infrastructure
plan: 01
type: execute
depends_on: []
files_modified: [package.json, vitest.config.ts, vitest.setup.ts, tsconfig.json]
---

<objective>
Vitest 테스트 프레임워크를 설정하여 프로젝트에 테스트 인프라를 구축합니다.

Purpose: 테스트 환경이 없으면 코드 변경 시 기능 검증이 불가능하고, 리팩토링 시 회귀 버그를 방지할 수 없습니다.
Output: `npm test` 명령으로 테스트를 실행할 수 있는 환경
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/codebase/TESTING.md
@.planning/codebase/STACK.md

**현재 상태:**
- 테스트 프레임워크 없음
- Next.js 16.1.1 + React 19 + TypeScript 5
- ESLint만 설정됨

**기술 선택:**
- Vitest: ESM 네이티브 지원, Jest 호환 API, 빠른 실행
- @testing-library/react: React 컴포넌트 테스트
- happy-dom: jsdom보다 가볍고 빠른 DOM 환경 (Next.js 16 권장)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Vitest 및 테스트 유틸리티 설치</name>
  <files>package.json</files>
  <action>
1. 테스트 관련 의존성 설치:
   ```bash
   npm install -D vitest @testing-library/react @testing-library/jest-dom happy-dom @vitejs/plugin-react
   ```
2. package.json의 scripts에 test 명령 추가:
   - `"test": "vitest"`
   - `"test:run": "vitest run"`
   - `"test:coverage": "vitest run --coverage"`

**주의:**
- jsdom 대신 happy-dom 사용 (더 가볍고 빠름)
- @vitejs/plugin-react는 JSX 변환에 필요
  </action>
  <verify>`npm install` 성공, `npm run test:run` 명령이 존재함</verify>
  <done>Vitest 및 테스트 유틸리티가 devDependencies에 추가됨</done>
</task>

<task type="auto">
  <name>Task 2: Vitest 설정 파일 생성</name>
  <files>vitest.config.ts</files>
  <action>
1. 프로젝트 루트에 `vitest.config.ts` 생성:
   ```typescript
   import { defineConfig } from 'vitest/config';
   import react from '@vitejs/plugin-react';
   import path from 'path';

   export default defineConfig({
     plugins: [react()],
     test: {
       environment: 'happy-dom',
       globals: true,
       setupFiles: ['./vitest.setup.ts'],
       include: ['src/**/*.{test,spec}.{ts,tsx}'],
       exclude: ['node_modules', '.next'],
     },
     resolve: {
       alias: {
         '@': path.resolve(__dirname, './src'),
       },
     },
   });
   ```

2. `vitest.setup.ts` 생성:
   ```typescript
   import '@testing-library/jest-dom/vitest';
   ```

**주의:**
- `globals: true`로 describe/it/expect 전역 사용
- `@/*` 경로 별칭 설정 필수 (tsconfig.json과 동일)
- happy-dom 환경 사용
  </action>
  <verify>`npx vitest run` 실행 시 설정 파일 인식됨 (테스트 없어도 오류 없이 종료)</verify>
  <done>vitest.config.ts와 vitest.setup.ts 생성됨</done>
</task>

<task type="auto">
  <name>Task 3: TypeScript 설정 업데이트 및 샘플 테스트 생성</name>
  <files>tsconfig.json, src/lib/utils.test.ts</files>
  <action>
1. tsconfig.json에 Vitest 타입 추가:
   - `compilerOptions.types`에 `"vitest/globals"` 추가
   - 기존 타입 유지

2. 샘플 테스트 파일 생성 (`src/lib/utils.test.ts`):
   ```typescript
   import { describe, it, expect } from 'vitest';
   import { cn } from './utils';

   describe('cn utility', () => {
     it('should merge class names', () => {
       expect(cn('foo', 'bar')).toBe('foo bar');
     });

     it('should handle conditional classes', () => {
       expect(cn('foo', false && 'bar', 'baz')).toBe('foo baz');
     });

     it('should merge Tailwind classes correctly', () => {
       expect(cn('px-2 py-1', 'px-4')).toBe('py-1 px-4');
     });
   });
   ```

**주의:**
- 샘플 테스트로 환경 검증
- cn 함수는 tailwind-merge를 사용하므로 px-4가 px-2를 덮어씀
  </action>
  <verify>`npm run test:run` 성공, 3개 테스트 통과</verify>
  <done>TypeScript 타입 설정 완료, 샘플 테스트 통과</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run test:run` 성공
- [ ] 샘플 테스트 3개 통과
- [ ] `npm run build` 여전히 성공
- [ ] `npm run lint` 경고/에러 없음
</verification>

<success_criteria>

- Vitest 테스트 환경 설정 완료
- `npm test` 명령으로 테스트 실행 가능
- 샘플 테스트 통과
- 빌드/린트 영향 없음
</success_criteria>

<output>
After completion, create `.planning/phases/03-testing-infrastructure/03-01-SUMMARY.md`
</output>
