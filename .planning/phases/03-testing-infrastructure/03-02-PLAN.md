---
phase: 03-testing-infrastructure
plan: 02
type: execute
depends_on: ["03-01"]
files_modified: [src/lib/utils.test.ts, src/lib/system.test.ts]
---

<objective>
유틸리티 함수들(utils.ts, system.ts)에 대한 단위 테스트를 작성합니다.

Purpose: 순수 함수는 입력과 출력이 명확하여 테스트하기 쉽고, 높은 커버리지로 신뢰성을 확보할 수 있습니다.
Output: utils.ts와 system.ts의 주요 함수에 대한 테스트 커버리지
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-testing-infrastructure/03-01-SUMMARY.md

**테스트 대상 함수 (src/lib/utils.ts):**
- `formatBytes(bytes, decimals)` - 바이트를 사람이 읽기 쉬운 형식으로 변환
- `formatUptime(seconds)` - 초를 일/시간/분 형식으로 변환
- `getStatusColor(status)` - 상태에 따른 색상 클래스 반환
- `cn(...inputs)` - Tailwind 클래스 병합 (03-01에서 테스트 작성됨)

**테스트 대상 함수 (src/lib/system.ts):**
- `parseProcStat(content)` - /proc/stat 파싱 (순수 함수)
- `calculateCpuPercent(prev, curr)` - CPU 사용률 계산 (순수 함수)
- `parseProcMeminfo(content)` - /proc/meminfo 파싱 (순수 함수)
</context>

<tasks>

<task type="auto">
  <name>Task 1: utils.ts 전체 테스트 작성</name>
  <files>src/lib/utils.test.ts</files>
  <action>
기존 샘플 테스트를 확장하여 모든 유틸리티 함수 테스트:

1. `formatBytes` 테스트:
   - 0 bytes → "0 Bytes"
   - 1024 → "1 KB"
   - 1048576 → "1 MB"
   - 1073741824 → "1 GB"
   - decimals 파라미터 동작
   - 음수 decimals 처리

2. `formatUptime` 테스트:
   - 30초 → "0m" (1분 미만은 분으로 표시)
   - 3600초 → "1h 0m"
   - 86400초 → "1d 0h"
   - 90061초 → "1d 1h" (복합)

3. `getStatusColor` 테스트:
   - "running" → "text-success"
   - "stopped" → "text-muted-foreground"
   - "starting" → "text-warning"
   - "error" → "text-destructive"
   - 대소문자 무관 ("RUNNING" 등)
   - 알 수 없는 상태 → 기본값

**주의:**
- 각 함수별 describe 블록으로 구분
- 엣지 케이스 포함 (0, 음수, 빈 문자열 등)
  </action>
  <verify>`npm run test:run src/lib/utils.test.ts` 모든 테스트 통과</verify>
  <done>utils.ts의 모든 함수에 대한 테스트 작성 완료</done>
</task>

<task type="auto">
  <name>Task 2: system.ts 순수 함수 테스트 작성</name>
  <files>src/lib/system.test.ts</files>
  <action>
system.ts의 순수 함수들에 대한 테스트 작성:

1. 먼저 system.ts에서 내부 함수들이 export되어 있는지 확인
   - 내부 함수라면 테스트를 위해 export 추가 필요 (별도 named export)

2. `parseProcStat` 테스트 (또는 해당 로직):
   - 유효한 /proc/stat 형식 파싱
   - 빈 입력 처리
   - 잘못된 형식 처리

3. `calculateCpuPercent` 테스트:
   - 0% 사용률 (idle 상태)
   - 100% 사용률 (full load)
   - 일반적인 사용률 (30-70%)
   - 경계값 처리

4. 메모리 파싱 테스트:
   - MemTotal, MemFree, MemAvailable 추출
   - KB → bytes 변환

**주의:**
- execSync 호출이 필요한 함수는 mocking 필요
- 순수 파싱 함수만 이 플랜에서 테스트
- 외부 의존성 있는 함수는 통합 테스트로 분리
  </action>
  <verify>`npm run test:run src/lib/system.test.ts` 모든 테스트 통과</verify>
  <done>system.ts 순수 함수 테스트 완료</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run test:run` 모든 테스트 통과
- [ ] utils.ts 함수들 테스트 커버리지 확보
- [ ] system.ts 순수 함수 테스트 커버리지 확보
- [ ] `npm run build` 성공
</verification>

<success_criteria>

- utils.ts 4개 함수 테스트 완료
- system.ts 순수 함수 테스트 완료
- 모든 테스트 통과
- 엣지 케이스 포함
</success_criteria>

<output>
After completion, create `.planning/phases/03-testing-infrastructure/03-02-SUMMARY.md`
</output>
