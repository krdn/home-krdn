---
phase: 14-project-admin-crud
plan: 01
type: execute
depends_on: []
files_modified: [data/projects.json, src/lib/projects.ts, src/app/api/projects/route.ts, src/app/api/projects/[id]/route.ts, src/types/project.ts, src/app/admin/projects/page.tsx, src/components/admin/ProjectForm.tsx]
domain: next-js
---

<objective>
프로젝트 CRUD API 및 Admin UI 구현

Purpose: 프로젝트 갤러리 데이터를 Admin 페이지에서 동적으로 관리할 수 있도록 합니다.
Output: JSON 파일 기반 프로젝트 데이터 저장소, REST API (CRUD), Admin 관리 UI
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**기존 파일 (읽기 필요):**
@src/types/project.ts - 프로젝트 타입 정의
@src/config/projects.ts - 기존 정적 프로젝트 데이터
@src/app/api/projects/route.ts - 기존 GET API
@src/middleware.ts - 인증 미들웨어 (참고)

**Tech stack available:**
- Zod (validation)
- Jose (JWT auth)
- Next.js App Router API routes

**Established patterns:**
- API 응답 형식: `{ success: boolean, data?: T, error?: string }`
- Zod schema로 입력 검증
- 한국어 주석 + 영어 코드

**Constraining decisions:**
- JSON 파일 저장 방식 선택 (사용자 결정)
- /admin/* 경로는 이미 middleware로 인증 보호됨
- /api/projects는 현재 public (인증 불필요 - 읽기만)
</context>

<tasks>

<task type="auto">
  <name>Task 1: JSON 데이터 저장소 및 CRUD 라이브러리 구현</name>
  <files>data/projects.json, src/lib/projects.ts, src/types/project.ts</files>
  <action>
1. `data/projects.json` 생성:
   - 기존 `src/config/projects.ts`의 projects 배열을 JSON으로 마이그레이션
   - 형식: `{ "projects": [...], "lastUpdated": "ISO date" }`

2. `src/lib/projects.ts` 생성 (서버 전용 유틸리티):
   ```typescript
   // 파일 경로 상수
   const DATA_FILE = path.join(process.cwd(), 'data/projects.json');

   // CRUD 함수들
   export async function getAllProjects(): Promise<Project[]>
   export async function getProjectById(id: string): Promise<Project | null>
   export async function createProject(data: CreateProjectInput): Promise<Project>
   export async function updateProject(id: string, data: UpdateProjectInput): Promise<Project>
   export async function deleteProject(id: string): Promise<boolean>
   ```
   - fs/promises로 JSON 파일 읽기/쓰기
   - 동시성 문제 방지를 위해 간단한 락 메커니즘 적용 (선택적)
   - ID 생성: crypto.randomUUID() 사용

3. `src/types/project.ts` 확장:
   - `CreateProjectInput` 타입 추가 (id 제외한 필수 필드)
   - `UpdateProjectInput` 타입 추가 (모든 필드 optional)
   - Zod 스키마 추가: `createProjectSchema`, `updateProjectSchema`

주의: Node.js fs 모듈은 서버에서만 사용 가능. 'server-only' import 추가.
  </action>
  <verify>
- `data/projects.json` 파일 존재 확인
- `npm run build` 성공 (타입 에러 없음)
  </verify>
  <done>
- JSON 데이터 파일에 기존 5개 프로젝트 마이그레이션 완료
- CRUD 유틸리티 함수 구현 완료
- Zod 스키마로 입력 검증 가능
  </done>
</task>

<task type="auto">
  <name>Task 2: 프로젝트 CRUD API 엔드포인트 구현</name>
  <files>src/app/api/projects/route.ts, src/app/api/projects/[id]/route.ts</files>
  <action>
1. `src/app/api/projects/route.ts` 수정:
   - 기존 GET 유지 (config에서 lib으로 import 변경)
   - POST 추가: 새 프로젝트 생성
     - Body: CreateProjectInput
     - Zod validation 적용
     - 응답: `{ success: true, project: Project }`

2. `src/app/api/projects/[id]/route.ts` 생성:
   - GET: 단일 프로젝트 조회
   - PUT: 프로젝트 수정
     - Body: UpdateProjectInput
     - Zod validation 적용
   - DELETE: 프로젝트 삭제

3. 인증 보호:
   - POST/PUT/DELETE는 middleware matcher에 추가 필요
   - `/api/projects/:path*` (쓰기 작업만) 패턴 검토
   - 또는 route 내에서 수동 인증 체크 (더 세밀한 제어)

   권장: route 내에서 쓰기 작업에 대해 수동 인증 체크
   (GET은 public 유지, POST/PUT/DELETE만 인증 필요)

   ```typescript
   // 인증 체크 헬퍼
   import { cookies } from 'next/headers';
   import { verifyToken } from '@/lib/auth';

   async function requireAuth() {
     const cookieStore = await cookies();
     const token = cookieStore.get('auth-token')?.value;
     if (!token) throw new Error('UNAUTHORIZED');
     const result = await verifyToken(token);
     if (!result.valid) throw new Error('UNAUTHORIZED');
     return result.payload;
   }
   ```

주의사항:
- 이미지 업로드는 이 phase에서 구현하지 않음 (URL 직접 입력)
- slug 중복 검사 구현 필요
  </action>
  <verify>
curl 테스트:
```bash
# GET all (public)
curl http://localhost:3000/api/projects

# POST (auth required - 로그인 후 쿠키 사용)
curl -X POST http://localhost:3000/api/projects \
  -H "Content-Type: application/json" \
  -H "Cookie: auth-token=..." \
  -d '{"name":"Test","slug":"test","description":"Test project","category":"web","status":"planned","techStack":[],"links":[],"images":[]}'

# PUT
curl -X PUT http://localhost:3000/api/projects/[id] \
  -H "Content-Type: application/json" \
  -H "Cookie: auth-token=..." \
  -d '{"name":"Updated Test"}'

# DELETE
curl -X DELETE http://localhost:3000/api/projects/[id] \
  -H "Cookie: auth-token=..."
```
  </verify>
  <done>
- GET /api/projects - 전체 목록 조회 (public)
- POST /api/projects - 새 프로젝트 생성 (auth)
- GET /api/projects/[id] - 단일 조회 (public)
- PUT /api/projects/[id] - 수정 (auth)
- DELETE /api/projects/[id] - 삭제 (auth)
- 모든 쓰기 작업에 인증 검사 적용
  </done>
</task>

<task type="auto">
  <name>Task 3: Admin 프로젝트 관리 UI 구현</name>
  <files>src/app/admin/projects/page.tsx, src/components/admin/ProjectForm.tsx, src/components/layout/Sidebar.tsx</files>
  <action>
1. `src/components/admin/ProjectForm.tsx` 생성:
   - 폼 필드: name, slug, description, longDescription, category, status, featured, order
   - techStack, links, images는 동적 배열 입력
   - React Hook Form + Zod resolver 사용 (또는 controlled inputs)
   - 모드: 'create' | 'edit'
   - onSubmit 콜백으로 API 호출
   - 취소/저장 버튼

   간단한 구현을 위해 controlled inputs 사용 (react-hook-form 미설치 시)

2. `src/app/admin/projects/page.tsx` 생성:
   - 프로젝트 목록 테이블 (DataTable 스타일)
     - 컬럼: 이름, 카테고리, 상태, Featured, Actions
     - Actions: Edit, Delete 버튼
   - "새 프로젝트" 버튼
   - 생성/수정 시 Dialog 또는 별도 페이지로 폼 표시
   - useMutation 또는 fetch로 API 호출
   - 성공/실패 Toast 알림

3. `src/components/layout/Sidebar.tsx` 수정:
   - Admin 사이드바에 "Projects" 링크 추가
   - 아이콘: FolderKanban (lucide-react)
   - 경로: /admin/projects

UI 패턴:
- 기존 admin 페이지 스타일 따르기
- Card, Button, Badge 컴포넌트 재사용
- 반응형 레이아웃 (모바일 고려)

주의: 이미지 업로드 기능은 Phase 15에서 구현 예정
현재는 이미지 URL 직접 입력으로 처리
  </action>
  <verify>
1. 브라우저에서 /admin/projects 접근
2. 프로젝트 목록 표시 확인
3. 새 프로젝트 생성 폼 동작
4. 수정/삭제 기능 동작
5. `npm run build` 성공
  </verify>
  <done>
- /admin/projects 페이지에서 프로젝트 CRUD 가능
- 사이드바에 Projects 메뉴 추가
- 폼 validation 동작
- 성공/실패 알림 표시
  </done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `data/projects.json` 파일 존재 및 기존 데이터 마이그레이션 확인
- [ ] `npm run build` 성공
- [ ] API 엔드포인트 CRUD 동작 (curl 또는 브라우저 테스트)
- [ ] /admin/projects UI에서 전체 플로우 동작
- [ ] 인증 없이 POST/PUT/DELETE 시 401 반환 확인
</verification>

<success_criteria>

- 모든 task 완료
- 프로젝트 생성/조회/수정/삭제 전체 플로우 동작
- Admin 페이지에서 프로젝트 관리 가능
- 인증된 사용자만 쓰기 작업 가능
- TypeScript 타입 에러 없음
</success_criteria>

<output>
After completion, create `.planning/phases/14-project-admin-crud/14-01-SUMMARY.md`:

# Phase 14 Plan 01: Project Admin CRUD Summary

**[한 줄 요약]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase complete, ready for Phase 15 (Admin Dashboard)
</output>
