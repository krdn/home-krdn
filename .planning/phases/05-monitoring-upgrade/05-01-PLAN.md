# Plan 05-01: 메트릭 수집 강화 (네트워크, 프로세스)

## Objective

현재 CPU, Memory, Disk 메트릭 외에 네트워크 및 프로세스 정보를 추가로 수집하여 더 상세한 시스템 모니터링을 제공합니다.

## Execution Context

**Codebase context:**
- `src/lib/system.ts` - 시스템 메트릭 수집 라이브러리
- `src/app/api/system/route.ts` - 시스템 API 엔드포인트
- `src/hooks/useSystemMetrics.ts` - 메트릭 데이터 훅
- `src/components/admin/DashboardStats.tsx` - 대시보드 통계 카드

**Dependencies:**
- Node.js `os` 모듈 (networkInterfaces)
- Node.js `child_process` (프로세스 정보)
- `/proc/net/dev` (네트워크 통계)

**Prior decisions:**
- execSync 사용 (동기 명령 실행)
- 순수 함수 분리 패턴 (테스트 가능성)

## Context

Phase 5: Monitoring Upgrade의 첫 번째 계획입니다.

**현재 수집 메트릭:**
- CPU: usage, cores, model, loadAvg
- Memory: total, used, free, usage
- Disk: total, used, free, usage, path
- System: uptime, hostname, platform

**추가할 메트릭:**
- Network: interfaces, rx/tx bytes, rx/tx packets
- Processes: top 5 by CPU/Memory, total count

## Tasks

### Task 1: 네트워크 메트릭 수집 함수 추가

**File:** `src/lib/system.ts`

**Changes:**
1. `NetworkInterface` 타입 정의 추가
2. `parseNetDev()` 순수 함수 추가 (/proc/net/dev 파싱)
3. `getNetworkInfo()` 함수 추가

**Implementation:**
```typescript
export interface NetworkInterface {
  name: string;
  rxBytes: number;
  txBytes: number;
  rxPackets: number;
  txPackets: number;
}

export function parseNetDev(content: string): NetworkInterface[] {
  // /proc/net/dev 파싱 로직
}

function getNetworkInfo(): NetworkInterface[] {
  // execSync로 /proc/net/dev 읽기
}
```

**Commit:** `feat(05-01): 네트워크 메트릭 수집 함수 추가`

### Task 2: 프로세스 메트릭 수집 함수 추가

**File:** `src/lib/system.ts`

**Changes:**
1. `ProcessInfo` 타입 정의 추가
2. `parseProcessList()` 순수 함수 추가
3. `getTopProcesses()` 함수 추가

**Implementation:**
```typescript
export interface ProcessInfo {
  pid: number;
  name: string;
  cpu: number;
  memory: number;
}

export function parseProcessList(output: string): ProcessInfo[] {
  // ps aux 출력 파싱
}

function getTopProcesses(limit: number = 5): ProcessInfo[] {
  // ps aux --sort 명령 실행
}
```

**Commit:** `feat(05-01): 프로세스 메트릭 수집 함수 추가`

### Task 3: SystemMetrics 타입 확장 및 API 업데이트

**Files:**
- `src/lib/system.ts` - SystemMetrics 타입 확장
- `src/app/api/system/route.ts` - API 응답에 새 메트릭 포함
- `src/hooks/useSystemMetrics.ts` - 훅 타입 업데이트

**Changes:**
1. SystemMetrics 타입에 network, processes 필드 추가
2. getSystemMetrics()에 새 메트릭 통합
3. API 응답 및 훅 타입 동기화

**Commit:** `feat(05-01): 시스템 메트릭 타입 확장 및 API 업데이트`

### Task 4: 확장 메트릭 테스트 작성

**File:** `src/lib/system.test.ts`

**Changes:**
1. `parseNetDev()` 단위 테스트 추가
2. `parseProcessList()` 단위 테스트 추가
3. 엣지 케이스 테스트 (빈 입력, 잘못된 형식)

**Commit:** `test(05-01): 네트워크/프로세스 메트릭 파싱 테스트 추가`

## Verification

```bash
# 빌드 확인
npm run build

# 타입 체크
npx tsc --noEmit

# 테스트 실행
npm run test

# API 동작 확인
curl -s http://localhost:3000/api/system | jq '.data.network, .data.processes'
```

## Success Criteria

- [ ] 네트워크 인터페이스 목록과 트래픽 통계가 API에서 반환됨
- [ ] 상위 5개 프로세스 (CPU/Memory 기준) 정보가 API에서 반환됨
- [ ] 순수 함수 단위 테스트 통과
- [ ] 기존 테스트 및 빌드 성공

## Output

**Modified files:**
- `src/lib/system.ts`
- `src/app/api/system/route.ts`
- `src/hooks/useSystemMetrics.ts`
- `src/lib/system.test.ts`

**Commits:** 4 commits (per task)

---
*Created: 2026-01-14*
