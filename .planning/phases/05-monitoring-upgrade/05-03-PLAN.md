# Plan 05-03: 차트/그래프 시각화

## Objective

Recharts 라이브러리를 활용하여 시스템 메트릭 히스토리를 시각적인 차트로 표현하고, 대시보드에 통합합니다.

## Execution Context

**Codebase context:**
- `src/hooks/useMetricsHistory.ts` - 히스토리 데이터 훅 (05-02)
- `src/components/admin/DashboardStats.tsx` - 대시보드 통계 카드
- `src/config/design.ts` - 디자인 토큰
- `src/app/globals.css` - CSS 변수

**Dependencies:**
- 05-02 완료 (히스토리 저장/조회)
- Recharts 3.6.0 (이미 설치됨)

**Design patterns:**
- 반응형 차트 (ResponsiveContainer)
- 다크 테마 호환 (CSS 변수 사용)
- 디자인 시스템 토큰 활용

## Context

Phase 5: Monitoring Upgrade의 세 번째(마지막) 계획입니다.

**현재 상태:**
- Recharts 설치됨 (미사용)
- 히스토리 API 및 훅 준비됨 (05-02)
- 숫자 기반 대시보드만 존재

**추가 기능:**
- CPU/Memory/Disk 라인 차트
- 네트워크 트래픽 영역 차트
- 대시보드 차트 섹션

## Tasks

### Task 1: 기본 차트 컴포넌트 생성

**File:** `src/components/charts/MetricsLineChart.tsx` (신규)

**Changes:**
1. Recharts 래퍼 컴포넌트
2. 반응형 컨테이너 적용
3. 다크 테마 호환 스타일링
4. 공통 props (data, dataKey, color, title)

**Implementation:**
```typescript
'use client';

import {
  ResponsiveContainer,
  LineChart,
  Line,
  XAxis,
  YAxis,
  Tooltip,
  CartesianGrid,
} from 'recharts';

interface MetricsLineChartProps {
  data: Array<{ timestamp: number; value: number }>;
  title: string;
  color?: string;
  unit?: string;
}

export function MetricsLineChart({
  data,
  title,
  color = 'hsl(var(--primary))',
  unit = '%',
}: MetricsLineChartProps) {
  return (
    <div className="h-64 w-full">
      <h3 className="mb-2 text-sm font-medium">{title}</h3>
      <ResponsiveContainer width="100%" height="100%">
        <LineChart data={data}>
          {/* ... */}
        </LineChart>
      </ResponsiveContainer>
    </div>
  );
}
```

**Commit:** `feat(05-03): 기본 라인 차트 컴포넌트 생성`

### Task 2: 네트워크 영역 차트 컴포넌트 생성

**File:** `src/components/charts/NetworkAreaChart.tsx` (신규)

**Changes:**
1. RX/TX 동시 표시 영역 차트
2. 바이트 단위 포맷팅
3. 그라디언트 채우기

**Implementation:**
```typescript
import { AreaChart, Area } from 'recharts';

interface NetworkAreaChartProps {
  data: Array<{
    timestamp: number;
    rx: number;
    tx: number;
  }>;
}

export function NetworkAreaChart({ data }: NetworkAreaChartProps) {
  return (
    <ResponsiveContainer>
      <AreaChart data={data}>
        <Area dataKey="rx" stroke="hsl(var(--success))" fill="..." />
        <Area dataKey="tx" stroke="hsl(var(--primary))" fill="..." />
      </AreaChart>
    </ResponsiveContainer>
  );
}
```

**Commit:** `feat(05-03): 네트워크 영역 차트 컴포넌트 생성`

### Task 3: 시스템 차트 대시보드 섹션 생성

**File:** `src/components/admin/MetricsCharts.tsx` (신규)

**Changes:**
1. 히스토리 훅 사용
2. CPU, Memory, Disk, Network 차트 그리드
3. 시간 범위 선택 (15분, 30분, 1시간)
4. 로딩/에러 상태 처리

**Implementation:**
```typescript
'use client';

import { useState } from 'react';
import { useMetricsHistory } from '@/hooks/useMetricsHistory';
import { MetricsLineChart } from '@/components/charts/MetricsLineChart';
import { NetworkAreaChart } from '@/components/charts/NetworkAreaChart';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/Card';

export function MetricsCharts() {
  const [minutes, setMinutes] = useState(30);
  const { data, loading } = useMetricsHistory(minutes);

  // 차트용 데이터 변환
  const cpuData = data.map(s => ({ timestamp: s.timestamp, value: s.cpu }));
  // ...

  return (
    <div className="grid gap-4 lg:grid-cols-2">
      {/* CPU Chart */}
      {/* Memory Chart */}
      {/* Disk Chart */}
      {/* Network Chart */}
    </div>
  );
}
```

**Commit:** `feat(05-03): 시스템 차트 대시보드 섹션 생성`

### Task 4: 대시보드 페이지에 차트 통합

**File:** `src/app/admin/page.tsx`

**Changes:**
1. MetricsCharts 컴포넌트 import
2. DashboardStats 아래 차트 섹션 추가
3. 섹션 제목 및 간격 조정

**Commit:** `feat(05-03): 대시보드에 메트릭 차트 통합`

### Task 5: 차트 커스텀 툴팁 및 스타일링

**File:** `src/components/charts/ChartTooltip.tsx` (신규)

**Changes:**
1. 커스텀 툴팁 컴포넌트
2. 시간 포맷팅 (HH:mm)
3. 값 포맷팅 (%, bytes)
4. 다크 테마 배경

**Implementation:**
```typescript
interface ChartTooltipProps {
  active?: boolean;
  payload?: Array<{ value: number; name: string }>;
  label?: number;
  unit?: string;
}

export function ChartTooltip({ active, payload, label, unit }: ChartTooltipProps) {
  if (!active || !payload?.length) return null;

  const time = new Date(label!).toLocaleTimeString('ko-KR', {
    hour: '2-digit',
    minute: '2-digit',
  });

  return (
    <div className="rounded-lg border bg-popover px-3 py-2 shadow-md">
      <p className="text-xs text-muted-foreground">{time}</p>
      {payload.map((entry, i) => (
        <p key={i} className="text-sm font-medium">
          {entry.name}: {entry.value}{unit}
        </p>
      ))}
    </div>
  );
}
```

**Commit:** `feat(05-03): 차트 커스텀 툴팁 컴포넌트 추가`

## Verification

```bash
# 빌드 확인
npm run build

# 타입 체크
npx tsc --noEmit

# 개발 서버에서 시각적 확인
npm run dev
# http://localhost:3000/admin 접속하여 차트 확인
```

## Success Criteria

- [ ] 라인 차트가 CPU, Memory, Disk 데이터를 표시함
- [ ] 영역 차트가 네트워크 RX/TX를 표시함
- [ ] 차트가 다크/라이트 테마 모두에서 잘 보임
- [ ] 시간 범위 선택 동작함
- [ ] 반응형 레이아웃 적용됨
- [ ] 빌드 및 타입 체크 성공

## Output

**New files:**
- `src/components/charts/MetricsLineChart.tsx`
- `src/components/charts/NetworkAreaChart.tsx`
- `src/components/charts/ChartTooltip.tsx`
- `src/components/admin/MetricsCharts.tsx`

**Modified files:**
- `src/app/admin/page.tsx`

**Commits:** 5 commits (per task)

---
*Created: 2026-01-14*
