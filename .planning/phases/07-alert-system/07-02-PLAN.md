# Plan 07-02: 알림 규칙 설정 UI

---
phase: 07-alert-system
plan: 02
type: execute
depends_on: ["07-01"]
files_modified:
  - src/components/admin/AlertRulesPanel.tsx
  - src/components/admin/AlertRuleForm.tsx
  - src/app/admin/alerts/page.tsx
---

## Objective

사용자가 알림 규칙을 관리할 수 있는 UI를 구현합니다. 규칙 목록, 추가/수정/삭제, 활성화 토글 기능을 제공합니다.

Purpose: 사용자 정의 알림 임계값 설정 인터페이스
Output: 알림 규칙 관리 페이지 및 컴포넌트

## Execution Context

@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md

## Context

@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-alert-system/07-01-SUMMARY.md

**Tech stack available:**
- Radix UI (Dialog, Select 등)
- Tailwind CSS + design.ts 디자인 시스템
- Zustand alertStore

**Established patterns:**
- 디자인 시스템: src/config/design.ts
- UI 컴포넌트: src/components/ui/
- Admin 레이아웃: src/app/admin/layout.tsx

**Key files:**
@src/stores/alertStore.ts
@src/types/alert.ts
@src/config/design.ts

## Tasks

<task type="auto">
  <name>Task 1: 알림 규칙 목록 패널</name>
  <files>src/components/admin/AlertRulesPanel.tsx</files>
  <action>
알림 규칙 목록을 표시하는 패널:

```typescript
'use client';

import { memo } from 'react';
import { useAlertStore } from '@/stores/alertStore';
import { Switch } from '@/components/ui/Switch'; // 또는 Radix Switch
import { Button } from '@/components/ui/Button';
import { Card, CardHeader, CardContent } from '@/components/ui/Card';
import { AlertTriangle, Bell, Edit2, Trash2 } from 'lucide-react';
import type { AlertRule, AlertSeverity } from '@/types/alert';

const severityColors: Record<AlertSeverity, string> = {
  info: 'bg-blue-100 text-blue-800',
  warning: 'bg-yellow-100 text-yellow-800',
  critical: 'bg-red-100 text-red-800',
};

export const AlertRulesPanel = memo(function AlertRulesPanel({
  onEdit,
  onAdd,
}: {
  onEdit: (rule: AlertRule) => void;
  onAdd: () => void;
}) {
  const { rules, toggleRule, deleteRule } = useAlertStore();

  return (
    <Card>
      <CardHeader className="flex justify-between items-center">
        <h2>알림 규칙</h2>
        <Button onClick={onAdd}>+ 규칙 추가</Button>
      </CardHeader>
      <CardContent>
        <div className="space-y-3">
          {rules.map((rule) => (
            <RuleItem
              key={rule.id}
              rule={rule}
              onToggle={() => toggleRule(rule.id)}
              onEdit={() => onEdit(rule)}
              onDelete={() => deleteRule(rule.id)}
            />
          ))}
        </div>
      </CardContent>
    </Card>
  );
});
```

각 규칙 항목:
- 규칙 이름, 카테고리
- 조건 표시 (예: "CPU > 90%")
- 심각도 배지
- 활성화 토글 스위치
- 수정/삭제 버튼
  </action>
  <verify>npx tsc --noEmit</verify>
  <done>알림 규칙 목록 패널 컴포넌트 생성</done>
</task>

<task type="auto">
  <name>Task 2: 알림 규칙 폼</name>
  <files>src/components/admin/AlertRuleForm.tsx</files>
  <action>
알림 규칙 추가/수정 폼 (Dialog 기반):

```typescript
'use client';

import { useState } from 'react';
import * as Dialog from '@radix-ui/react-dialog';
import * as Select from '@radix-ui/react-select';
import { Button } from '@/components/ui/Button';
import { useAlertStore } from '@/stores/alertStore';
import type { AlertRule, AlertCategory, AlertSeverity } from '@/types/alert';

interface AlertRuleFormProps {
  rule?: AlertRule; // 수정 시 기존 규칙
  open: boolean;
  onOpenChange: (open: boolean) => void;
}

const categories: { value: AlertCategory; label: string; metrics: string[] }[] = [
  { value: 'cpu', label: 'CPU', metrics: ['usage'] },
  { value: 'memory', label: '메모리', metrics: ['usage'] },
  { value: 'disk', label: '디스크', metrics: ['usage'] },
  { value: 'network', label: '네트워크', metrics: ['rxBytes', 'txBytes'] },
  { value: 'container', label: '컨테이너', metrics: ['count', 'stopped'] },
];

const severities: { value: AlertSeverity; label: string }[] = [
  { value: 'info', label: '정보' },
  { value: 'warning', label: '경고' },
  { value: 'critical', label: '심각' },
];

export function AlertRuleForm({ rule, open, onOpenChange }: AlertRuleFormProps) {
  const { addRule, updateRule } = useAlertStore();
  const [formData, setFormData] = useState({
    name: rule?.name ?? '',
    category: rule?.category ?? 'cpu',
    metric: rule?.condition.metric ?? 'usage',
    operator: rule?.condition.operator ?? '>',
    threshold: rule?.condition.threshold ?? 90,
    severity: rule?.severity ?? 'warning',
    cooldown: rule?.cooldown ?? 300,
  });

  const handleSubmit = () => {
    const ruleData = {
      name: formData.name,
      category: formData.category as AlertCategory,
      condition: {
        metric: formData.metric,
        operator: formData.operator as AlertRule['condition']['operator'],
        threshold: formData.threshold,
      },
      severity: formData.severity as AlertSeverity,
      enabled: true,
      cooldown: formData.cooldown,
    };

    if (rule) {
      updateRule(rule.id, ruleData);
    } else {
      addRule(ruleData);
    }
    onOpenChange(false);
  };

  return (
    <Dialog.Root open={open} onOpenChange={onOpenChange}>
      {/* Dialog 구현 */}
    </Dialog.Root>
  );
}
```

폼 필드:
- 규칙 이름 (텍스트)
- 카테고리 (Select)
- 메트릭 (Select, 카테고리에 따라 변경)
- 연산자 (Select: >, <, >=, <=, ==)
- 임계값 (숫자 입력)
- 심각도 (Select)
- 쿨다운 시간 (숫자 입력, 초)
  </action>
  <verify>npx tsc --noEmit</verify>
  <done>알림 규칙 추가/수정 폼 컴포넌트 생성</done>
</task>

<task type="auto">
  <name>Task 3: 알림 관리 페이지</name>
  <files>src/app/admin/alerts/page.tsx</files>
  <action>
알림 규칙 관리 페이지 생성:

```typescript
'use client';

import { useState } from 'react';
import { AlertRulesPanel } from '@/components/admin/AlertRulesPanel';
import { AlertRuleForm } from '@/components/admin/AlertRuleForm';
import { AlertHistoryPanel } from '@/components/admin/AlertHistoryPanel';
import type { AlertRule } from '@/types/alert';

export default function AlertsPage() {
  const [editingRule, setEditingRule] = useState<AlertRule | null>(null);
  const [isFormOpen, setIsFormOpen] = useState(false);

  const handleEdit = (rule: AlertRule) => {
    setEditingRule(rule);
    setIsFormOpen(true);
  };

  const handleAdd = () => {
    setEditingRule(null);
    setIsFormOpen(true);
  };

  return (
    <div className="space-y-6">
      <h1 className="text-2xl font-bold">알림 설정</h1>

      <div className="grid gap-6 lg:grid-cols-2">
        <AlertRulesPanel onEdit={handleEdit} onAdd={handleAdd} />
        <AlertHistoryPanel />
      </div>

      <AlertRuleForm
        rule={editingRule ?? undefined}
        open={isFormOpen}
        onOpenChange={setIsFormOpen}
      />
    </div>
  );
}
```

간단한 AlertHistoryPanel도 추가 (최근 알림 목록):
- 활성 알림 표시
- 확인/해제 액션
  </action>
  <verify>npm run build</verify>
  <done>알림 관리 페이지가 /admin/alerts에서 접근 가능</done>
</task>

## Verification

```bash
# 타입 체크
npx tsc --noEmit

# 빌드 확인
npm run build

# 개발 서버에서 확인
# npm run dev
# http://localhost:3000/admin/alerts 접속
```

## Success Criteria

- [ ] 알림 규칙 목록이 표시됨
- [ ] 규칙 추가/수정/삭제가 동작함
- [ ] 규칙 활성화 토글이 동작함
- [ ] /admin/alerts 페이지 접근 가능
- [ ] 빌드 성공

## Output

After completion, create `.planning/phases/07-alert-system/07-02-SUMMARY.md`

---
*Created: 2026-01-14*
