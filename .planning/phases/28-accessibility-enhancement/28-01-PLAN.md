# Plan 28-01: ARIA Enhancement & Focus Management

## Overview

WCAG 레벨 A 요구사항 충족을 위한 긴급 접근성 개선. ARIA 속성 강화와 키보드 포커스 관리를 구현합니다.

## Goals

1. 아이콘 버튼 및 인터랙티브 요소에 ARIA 레이블 추가
2. 모달/다이얼로그 포커스 트랩 구현
3. 동적 콘텐츠에 aria-live 적용
4. 스킵 링크(Skip to Content) 추가

## Tasks

### Task 1: Icon Button Accessibility

아이콘만 있는 버튼에 `aria-label` 추가하고, 장식용 아이콘에 `aria-hidden` 적용.

**Files to modify**:
- `src/components/Header.tsx`
- `src/components/Sidebar.tsx`
- `src/components/projects/ProjectCard.tsx`

**Pattern**:
```tsx
// Before
<Button variant="ghost" size="icon">
  <Settings className="h-5 w-5" />
</Button>

// After
<Button variant="ghost" size="icon" aria-label="설정">
  <Settings className="h-5 w-5" aria-hidden="true" />
</Button>
```

**Verification**:
- 모든 아이콘 버튼에 aria-label 존재
- 스크린 리더 테스트

### Task 2: Focus Trap Hook

모달 및 다이얼로그용 포커스 트랩 훅을 생성합니다.

**File**: `src/hooks/useFocusTrap.ts`

```typescript
import { useEffect, useRef } from 'react';

/**
 * 모달/다이얼로그에서 포커스를 내부로 제한하는 훅
 */
export function useFocusTrap<T extends HTMLElement>(isActive: boolean = true) {
  const containerRef = useRef<T>(null);
  const previousFocusRef = useRef<HTMLElement | null>(null);

  useEffect(() => {
    if (!isActive) return;

    // 현재 포커스 저장
    previousFocusRef.current = document.activeElement as HTMLElement;

    const container = containerRef.current;
    if (!container) return;

    // 포커스 가능한 요소 찾기
    const focusableElements = container.querySelectorAll<HTMLElement>(
      'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
    );
    const firstElement = focusableElements[0];
    const lastElement = focusableElements[focusableElements.length - 1];

    // 첫 번째 요소로 포커스
    firstElement?.focus();

    // Tab 키 트랩
    const handleKeyDown = (e: KeyboardEvent) => {
      if (e.key !== 'Tab') return;

      if (e.shiftKey) {
        // Shift+Tab: 첫 번째에서 마지막으로
        if (document.activeElement === firstElement) {
          e.preventDefault();
          lastElement?.focus();
        }
      } else {
        // Tab: 마지막에서 첫 번째로
        if (document.activeElement === lastElement) {
          e.preventDefault();
          firstElement?.focus();
        }
      }
    };

    document.addEventListener('keydown', handleKeyDown);

    return () => {
      document.removeEventListener('keydown', handleKeyDown);
      // 포커스 복원
      previousFocusRef.current?.focus();
    };
  }, [isActive]);

  return containerRef;
}
```

**Verification**:
- Tab 키로 모달 내부에서만 순환
- ESC로 닫을 때 이전 포커스 복원

### Task 3: Modal Accessibility

InviteModal 및 기타 모달에 포커스 트랩과 ARIA 속성 적용.

**Files to modify**:
- `src/components/teams/InviteModal.tsx`
- `src/components/admin/WidgetCustomizer.tsx` (모달 부분)

**Pattern**:
```tsx
// Before
<motion.div className="modal-content">
  <h2>팀원 초대</h2>
  ...
</motion.div>

// After
const modalRef = useFocusTrap<HTMLDivElement>(isOpen);

<motion.div
  ref={modalRef}
  role="dialog"
  aria-modal="true"
  aria-labelledby="modal-title"
  className="modal-content"
>
  <h2 id="modal-title">팀원 초대</h2>
  ...
</motion.div>
```

**Verification**:
- 모달 열릴 때 첫 번째 인터랙티브 요소로 포커스
- Tab으로 모달 내부만 순환
- 닫힐 때 트리거 버튼으로 포커스 복원

### Task 4: Live Regions for Dynamic Content

토스트, 로딩 상태 등 동적 콘텐츠에 aria-live 적용.

**Files to modify**:
- `src/components/providers/ToastProvider.tsx`
- `src/components/admin/AdminDashboard.tsx`

**Pattern**:
```tsx
// Toast container
<div
  aria-live="polite"
  aria-atomic="true"
  className="toast-container"
>
  {toasts.map(toast => <Toast key={toast.id} {...toast} />)}
</div>

// Loading state
<div aria-live="polite" aria-busy={isLoading}>
  {isLoading ? (
    <span>데이터를 불러오는 중...</span>
  ) : (
    <div>{content}</div>
  )}
</div>
```

**Verification**:
- 토스트 나타날 때 스크린 리더가 읽음
- 로딩 완료 시 알림

### Task 5: Skip Link Component

키보드 사용자가 메인 콘텐츠로 바로 이동할 수 있는 스킵 링크 추가.

**File**: `src/components/ui/SkipLink.tsx`

```tsx
/**
 * 키보드 사용자용 스킵 링크
 * 포커스 시에만 표시됨
 */
export function SkipLink() {
  return (
    <a
      href="#main-content"
      className="
        sr-only focus:not-sr-only
        focus:absolute focus:top-4 focus:left-4
        focus:z-50 focus:px-4 focus:py-2
        focus:bg-primary focus:text-primary-foreground
        focus:rounded-md focus:outline-none focus:ring-2
      "
    >
      메인 콘텐츠로 건너뛰기
    </a>
  );
}
```

**Layout integration**:
```tsx
// src/app/layout.tsx
<body>
  <SkipLink />
  <Header />
  <main id="main-content" tabIndex={-1}>
    {children}
  </main>
  ...
</body>
```

**Verification**:
- Tab 키 첫 번째 포커스가 스킵 링크
- 활성화 시 main으로 포커스 이동

### Task 6: Form Error Accessibility

폼 필드 오류 메시지를 aria-describedby로 연결.

**Files to modify**:
- `src/components/alerts/AlertRuleForm.tsx`
- `src/components/teams/InviteModal.tsx`

**Pattern**:
```tsx
// Before
<input id="email" />
{error && <p className="text-red-500">{error}</p>}

// After
<input
  id="email"
  aria-invalid={!!error}
  aria-describedby={error ? "email-error" : undefined}
/>
{error && (
  <p id="email-error" role="alert" className="text-red-500">
    {error}
  </p>
)}
```

**Verification**:
- 오류 발생 시 스크린 리더가 오류 메시지 읽음
- aria-invalid 상태 반영

## Dependencies

- Phase 27 완료 (에러 핸들링)

## Verification Checklist

- [ ] Task 1: 아이콘 버튼 aria-label 추가
- [ ] Task 2: useFocusTrap 훅 구현
- [ ] Task 3: 모달 포커스 트랩 적용
- [ ] Task 4: aria-live 영역 추가
- [ ] Task 5: 스킵 링크 컴포넌트 추가
- [ ] Task 6: 폼 오류 aria-describedby 연결
- [ ] `npm run build` 성공
- [ ] 키보드 네비게이션 수동 테스트

## Commit Convention

```
feat(28-01): ARIA 속성 강화 및 포커스 관리 구현
```
