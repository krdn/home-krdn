---
phase: 20-user-dashboard-settings
plan: 03
type: execute
depends_on: ["20-02"]
files_modified: [src/types/dashboard.ts, src/stores/dashboardStore.ts, src/app/admin/page.tsx, src/components/admin/WidgetCustomizer.tsx]
---

<objective>
대시보드 위젯 커스터마이징 기능 구현

Purpose: 사용자가 대시보드 위젯의 가시성과 순서를 개인화할 수 있는 기능 제공
Output: 위젯 설정 스토어 + 위젯 커스터마이저 UI + 대시보드 동적 렌더링
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/20-user-dashboard-settings/20-02-SUMMARY.md

# 관련 소스 파일
@src/app/admin/page.tsx (현재 대시보드 - 하드코딩된 위젯)
@src/stores/alertStore.ts (Zustand persist 패턴)
@src/hooks/useSettings.ts (Plan 20-02에서 구현)

**Tech stack available:**
- Zustand + persist 미들웨어
- React Query

**Established patterns:**
- alertStore.ts Zustand persist 패턴
- 설정은 서버 저장 (dashboardLayout JSON)
</context>

<tasks>

<task type="auto">
  <name>Task 1: 위젯 레이아웃 타입 및 대시보드 스토어 구현</name>
  <files>src/types/dashboard.ts, src/stores/dashboardStore.ts</files>
  <action>
  1. src/types/dashboard.ts 생성:
     ```typescript
     // 위젯 ID 타입
     export type WidgetId =
       | 'system-stats'      // DashboardStats (CPU/Memory/Disk/Uptime)
       | 'metrics-charts'    // LazyMetricsCharts
       | 'containers'        // ContainerStats
       | 'services'          // RunningServicesCard
       | 'overview'          // AdminOverview
       | 'quick-links';      // Quick Access

     // 위젯 설정
     export interface WidgetConfig {
       id: WidgetId;
       visible: boolean;
       order: number;
     }

     // 대시보드 레이아웃
     export interface DashboardLayout {
       widgets: WidgetConfig[];
     }
     ```

  2. src/stores/dashboardStore.ts 생성:
     Zustand 스토어 (persist 사용하지 않음 - 서버 동기화)

     상태:
     - layout: DashboardLayout
     - isLoading: boolean

     액션:
     - setLayout(layout): 레이아웃 설정
     - toggleWidget(id): 위젯 가시성 토글
     - moveWidget(id, direction): 위젯 순서 변경 (up/down)
     - resetToDefault(): 기본 레이아웃으로 리셋
     - getVisibleWidgets(): 표시할 위젯 목록 (order 순)

     기본 레이아웃:
     모든 위젯 visible=true, order는 현재 페이지 순서

     서버 동기화:
     - useSettings의 dashboardLayout 필드 사용
     - JSON.stringify/parse로 변환
     - 스토어 변경 시 debounce 후 서버 저장 (컴포넌트에서 처리)
  </action>
  <verify>npx tsc --noEmit 타입 오류 없음</verify>
  <done>WidgetId, DashboardLayout 타입 정의, dashboardStore 구현 완료</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>대시보드에 위젯 커스터마이저 UI 및 동적 렌더링 적용</what-built>
  <files>src/components/admin/WidgetCustomizer.tsx, src/app/admin/page.tsx</files>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:3000/admin
    3. 대시보드 우측 상단에 "Customize" 버튼 확인
    4. 버튼 클릭 → 위젯 목록 패널 표시
    5. 위젯 on/off 토글 → 해당 위젯 표시/숨김 확인
    6. 위젯 순서 변경 (up/down) → 대시보드 순서 변경 확인
    7. 설정 저장 후 페이지 새로고침 → 설정 유지 확인
    8. "Reset" 버튼 → 기본 레이아웃 복구 확인
  </how-to-verify>
  <action>
  1. src/components/admin/WidgetCustomizer.tsx 생성:
     - 드롭다운 또는 사이드 패널 형태
     - 위젯 목록: 이름, visible 토글, 순서 변경 버튼
     - Reset to Default 버튼
     - 변경 시 자동 저장 (debounce 300ms)

     UI 구성:
     ```
     [Customize] 버튼 클릭 →
     ┌─────────────────────────┐
     │ Dashboard Widgets       │
     │ ☑ System Stats    ▲ ▼  │
     │ ☑ Metrics Charts  ▲ ▼  │
     │ ☑ Containers      ▲ ▼  │
     │ ☐ Services        ▲ ▼  │
     │ ☑ Overview        ▲ ▼  │
     │ ☑ Quick Links     ▲ ▼  │
     │ [Reset to Default]     │
     └─────────────────────────┘
     ```

  2. src/app/admin/page.tsx 수정:
     - useDashboardStore 훅 사용
     - useSettings로 초기 레이아웃 로드
     - 위젯 렌더링을 getVisibleWidgets() 결과에 따라 동적으로
     - Header에 WidgetCustomizer 버튼 추가

     위젯 컴포넌트 매핑:
     ```typescript
     const WIDGET_COMPONENTS: Record<WidgetId, React.ComponentType> = {
       'system-stats': DashboardStats,
       'metrics-charts': LazyMetricsCharts,
       'containers': ContainerStats,
       'services': RunningServicesCard,
       'overview': AdminOverview,
       'quick-links': QuickLinksSection,
     };
     ```

     Quick Links를 별도 컴포넌트로 추출하거나 인라인으로 처리
  </action>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` 성공
- [ ] 위젯 커스터마이저 UI 동작
- [ ] 위젯 토글 시 대시보드 반영
- [ ] 위젯 순서 변경 시 대시보드 반영
- [ ] 설정이 서버에 저장되고 새로고침 후 유지
</verification>

<success_criteria>

- 위젯 타입 및 스토어 구현 완료
- WidgetCustomizer 컴포넌트 구현 완료
- 대시보드 동적 렌더링 적용
- 설정 서버 동기화 동작
- Phase 20 complete
</success_criteria>

<output>
After completion, create `.planning/phases/20-user-dashboard-settings/20-03-SUMMARY.md`
</output>
