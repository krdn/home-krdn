---
phase: 20-user-dashboard-settings
plan: 02
type: execute
depends_on: ["20-01"]
files_modified: [src/app/admin/settings/page.tsx, src/hooks/useSettings.ts, src/components/ui/ThemeToggle.tsx]
---

<objective>
사용자 설정 UI 페이지 및 테마 서버 동기화 구현

Purpose: 사용자가 테마, 알림 설정을 변경하고 서버에 저장할 수 있는 인터페이스 제공
Output: /admin/settings 페이지 + useSettings 훅 + 테마 토글 서버 동기화
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/20-user-dashboard-settings/20-01-SUMMARY.md

# 관련 소스 파일
@src/hooks/useAuth.ts (인증 훅 패턴)
@src/components/ui/ThemeToggle.tsx (기존 테마 토글)
@src/components/admin/EmailSettings.tsx (설정 폼 패턴)
@src/components/admin/SlackSettings.tsx (설정 폼 패턴)

**Tech stack available:**
- React Query (useQuery, useMutation)
- Tailwind CSS + shadcn/ui 패턴

**Established patterns:**
- useAuth 훅 → useSettings 훅도 동일 패턴
- Settings 폼 UI: EmailSettings, SlackSettings 참고
</context>

<tasks>

<task type="auto">
  <name>Task 1: useSettings 훅 및 /admin/settings 페이지 구현</name>
  <files>src/hooks/useSettings.ts, src/app/admin/settings/page.tsx</files>
  <action>
  1. src/hooks/useSettings.ts 생성:
     - React Query useQuery로 GET /api/settings fetch
     - useMutation으로 PUT /api/settings 업데이트
     - 반환: { settings, isLoading, error, updateSettings, isUpdating }
     - staleTime: 5분, 설정 변경 시 invalidateQueries

  2. src/app/admin/settings/page.tsx 생성:
     "use client" 지시어 사용

     섹션 구성:
     - Header: "Settings" 제목 + 설명
     - 테마 설정 카드: Dark/Light 토글 (현재 테마 표시)
     - 알림 설정 카드: 이메일 알림 on/off, 푸시 알림 on/off
     - 저장 버튼 (변경사항 있을 때만 활성화) 또는 실시간 저장

     UI 패턴: EmailSettings.tsx, SlackSettings.tsx 참고
     Card + CardHeader + CardContent 구조
     Switch 컴포넌트 사용 (shadcn/ui)

     로딩/에러 상태 처리 필수

  주의: Switch 컴포넌트가 없으면 간단한 토글 버튼으로 대체 가능
  </action>
  <verify>npm run build 성공, /admin/settings 페이지 접근 가능</verify>
  <done>useSettings 훅 구현, /admin/settings 페이지에서 테마/알림 설정 변경 가능</done>
</task>

<task type="auto">
  <name>Task 2: 테마 토글 서버 동기화 연동</name>
  <files>src/components/ui/ThemeToggle.tsx</files>
  <action>
  기존 ThemeToggle.tsx 수정:

  현재: localStorage 기반 테마 전환만 수행
  목표: 로그인 상태면 서버에도 테마 설정 저장

  구현:
  1. useAuth 훅으로 로그인 상태 확인
  2. useSettings 훅으로 서버 설정 가져오기 (로그인 시)
  3. 테마 변경 시:
     - 로컬 테마 변경 (기존 로직 유지)
     - 로그인 상태면 updateSettings({ theme }) 호출
  4. 초기 로드 시:
     - 로그인 상태면 서버 설정의 theme 적용
     - 비로그인이면 기존 localStorage 사용

  주의:
  - 비로그인 사용자도 테마 변경 가능해야 함 (localStorage 폴백)
  - 서버 동기화는 best-effort (실패해도 로컬은 동작)
  - 초기 로드 시 깜빡임 방지를 위해 서버 값 우선 적용
  </action>
  <verify>로그인 후 테마 변경 → 로그아웃 → 재로그인 시 테마 유지 확인</verify>
  <done>ThemeToggle이 로그인 시 서버와 동기화됨, 비로그인 시 localStorage 사용</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` 성공
- [ ] /admin/settings 페이지 접근 및 설정 변경 가능
- [ ] 테마 변경이 서버에 저장됨 (로그인 시)
- [ ] 알림 설정 변경이 서버에 저장됨
</verification>

<success_criteria>

- useSettings 훅 구현 완료
- /admin/settings 페이지 구현 완료
- 테마 설정 서버 동기화 동작
- 알림 설정 UI 동작
</success_criteria>

<output>
After completion, create `.planning/phases/20-user-dashboard-settings/20-02-SUMMARY.md`
</output>
