---
phase: 37-log-viewer-ui
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/hooks/useLogStream.ts
  - src/components/logs/LogFilter.tsx
  - src/components/logs/LogEntry.tsx
  - src/components/logs/LogList.tsx
autonomous: true

must_haves:
  truths:
    - "useLogStream 훅으로 실시간 로그 스트림을 구독/해제할 수 있다"
    - "LogFilter로 소스/레벨 필터를 설정할 수 있다"
    - "LogList가 대용량 로그를 가상화하여 렌더링한다"
  artifacts:
    - path: "src/hooks/useLogStream.ts"
      provides: "실시간 로그 WebSocket 구독 훅"
      exports: ["useLogStream"]
    - path: "src/components/logs/LogFilter.tsx"
      provides: "로그 필터 UI 컴포넌트"
      exports: ["LogFilter"]
    - path: "src/components/logs/LogEntry.tsx"
      provides: "개별 로그 항목 컴포넌트"
      exports: ["LogEntry"]
    - path: "src/components/logs/LogList.tsx"
      provides: "가상화된 로그 목록 컴포넌트"
      exports: ["LogList"]
  key_links:
    - from: "src/hooks/useLogStream.ts"
      to: "WebSocket subscribe-logs"
      via: "sendMessage({ type: 'subscribe-logs' })"
      pattern: "subscribe-logs"
    - from: "src/components/logs/LogList.tsx"
      to: "@tanstack/react-virtual"
      via: "useVirtualizer import"
      pattern: "useVirtualizer"
---

<objective>
실시간 로그 스트림 훅 및 UI 컴포넌트 구현

Purpose: WebSocket 기반 실시간 로그 구독과 필터/목록 UI 컴포넌트를 구현합니다.
Output: useLogStream 훅 1개, LogFilter/LogEntry/LogList 컴포넌트 3개
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/types/log.ts
@src/types/websocket.ts
@src/hooks/useWebSocket.ts
@src/components/alerts/AlertHistoryPanel.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: useLogStream 훅 구현</name>
  <files>src/hooks/useLogStream.ts</files>
  <action>
    WebSocket 기반 실시간 로그 구독 훅:

    1. useLogStream 훅 구현:
       - 파라미터: LogStreamOptions (sources?, minLevel?, containers?, enabled?)
       - useWebSocket 훅 활용
       - subscribe-logs/unsubscribe-logs 메시지 전송
       - 'logs' 타입 메시지 수신 시 콜백 또는 상태 업데이트
       - 반환값: { logs, isStreaming, startStream, stopStream, clearLogs }

    2. 메시지 처리:
       - onMessage 콜백에서 type === 'logs' 체크
       - logs 배열에 새 로그 추가 (최대 1000개 유지)
       - 오래된 로그 자동 제거 (메모리 관리)

    3. 구독 옵션:
       - sources: LogSource[] (docker, journal, app)
       - minLevel: LogLevel (필터링 최소 레벨)
       - containers: string[] (특정 컨테이너만)

    참고 패턴:
    - @src/hooks/useRealtimeMetrics.ts (WebSocket 구독 패턴)
    - @src/types/websocket.ts의 WSLogSubscribeMessageSchema
  </action>
  <verify>
    tsc --noEmit → 타입 에러 없음
    useLogStream 훅이 export되고 import 가능
  </verify>
  <done>useLogStream이 실시간 로그 구독/해제를 지원한다</done>
</task>

<task type="auto">
  <name>Task 2: LogFilter 컴포넌트 구현</name>
  <files>src/components/logs/LogFilter.tsx</files>
  <action>
    로그 필터 UI 컴포넌트:

    1. Props 정의:
       - sources: LogSource[] (선택된 소스 목록)
       - levels: LogLevel[] (선택된 레벨 목록)
       - search: string (검색어)
       - onSourcesChange, onLevelsChange, onSearchChange 콜백

    2. UI 구성:
       - 소스 필터: docker/journal/app 체크박스 또는 멀티셀렉트
       - 레벨 필터: trace~fatal 체크박스 또는 드롭다운
       - 검색 입력: 텍스트 인풋 (디바운스 적용)
       - 초기화 버튼: 모든 필터 리셋

    3. 스타일링:
       - 기존 Card/CardContent 컴포넌트 사용
       - 반응형: 모바일에서 접기/펼치기
       - LOG_LEVEL_COLORS 활용하여 레벨 색상 표시

    참고 패턴:
    - @src/components/alerts/AlertFilters.tsx 또는 유사 필터 UI
    - @src/types/log.ts의 LogLevel, LogSource, LOG_LEVEL_COLORS
  </action>
  <verify>
    tsc --noEmit → 타입 에러 없음
    LogFilter 컴포넌트가 export되고 import 가능
  </verify>
  <done>LogFilter가 소스/레벨/검색 필터 UI를 제공한다</done>
</task>

<task type="auto">
  <name>Task 3: LogEntry 및 LogList 컴포넌트 구현</name>
  <files>src/components/logs/LogEntry.tsx, src/components/logs/LogList.tsx</files>
  <action>
    1. LogEntry 컴포넌트:
       - Props: LogEntry 타입 (id, source, sourceId, level, message, timestamp, metadata)
       - UI: [시간] [레벨] [소스:sourceId] 메시지
       - LOG_LEVEL_COLORS로 레벨 색상 적용
       - 타임스탬프 포맷: HH:mm:ss.SSS
       - 메타데이터 펼치기 버튼 (선택)
       - React.memo로 성능 최적화

    2. LogList 컴포넌트:
       - Props: logs: LogEntry[], isLoading?, emptyMessage?
       - @tanstack/react-virtual의 useVirtualizer 사용
       - 고정 높이 행 (estimateSize: 28~32px)
       - 스크롤 컨테이너 ref 연결
       - 빈 상태 UI (로그 없을 때)
       - 로딩 스피너 (isLoading 시)

    참고 패턴:
    - @src/components/alerts/AlertHistoryPanel.tsx (가상화 패턴)
    - @src/components/containers/ContainerList.tsx (목록 가상화)
  </action>
  <verify>
    tsc --noEmit → 타입 에러 없음
    npm run build → 빌드 성공
  </verify>
  <done>LogEntry와 LogList가 가상화된 로그 목록을 렌더링한다</done>
</task>

</tasks>

<verification>
Plan 완료 전 확인:
- [ ] useLogStream 훅이 WebSocket으로 실시간 로그 구독
- [ ] LogFilter가 소스/레벨/검색 필터 UI 제공
- [ ] LogEntry가 개별 로그를 색상과 함께 표시
- [ ] LogList가 @tanstack/react-virtual로 가상화
- [ ] tsc --noEmit 통과
</verification>

<success_criteria>
- 모든 태스크 완료
- useLogStream 훅 정상 동작
- LogFilter, LogEntry, LogList 컴포넌트 export
- 가상화로 대용량 로그 처리 가능
</success_criteria>

<output>
완료 후 `.planning/phases/37-log-viewer-ui/37-02-SUMMARY.md` 생성
</output>
