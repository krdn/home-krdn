---
phase: 37-log-viewer-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/api/logs/route.ts
  - src/app/api/logs/stats/route.ts
  - src/hooks/useLogs.ts
autonomous: true

must_haves:
  truths:
    - "GET /api/logs가 필터링/페이지네이션 된 로그 목록을 반환한다"
    - "GET /api/logs/stats가 소스별/레벨별 통계를 반환한다"
    - "useLogs 훅으로 로그 조회 및 필터링이 가능하다"
  artifacts:
    - path: "src/app/api/logs/route.ts"
      provides: "로그 조회 REST API"
      exports: ["GET"]
    - path: "src/app/api/logs/stats/route.ts"
      provides: "로그 통계 REST API"
      exports: ["GET"]
    - path: "src/hooks/useLogs.ts"
      provides: "로그 조회 React 훅"
      exports: ["useLogs", "useLogStats"]
  key_links:
    - from: "src/hooks/useLogs.ts"
      to: "/api/logs"
      via: "fetch in useQuery"
      pattern: "fetch.*api/logs"
    - from: "src/app/api/logs/route.ts"
      to: "logStorage.query"
      via: "서비스 호출"
      pattern: "logStorage\\.query"
---

<objective>
로그 조회 REST API 및 useLogs 훅 구현

Purpose: Phase 36에서 구축한 LogStorage를 기반으로 로그 조회 API와 React Query 훅을 구현합니다.
Output: 로그 목록/통계 API 2개, useLogs/useLogStats 훅
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/36-log-aggregation/36-01-SUMMARY.md

@src/types/log.ts
@src/lib/log-storage.ts
@src/hooks/usePorts.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Log REST API 구현 (/api/logs)</name>
  <files>src/app/api/logs/route.ts, src/app/api/logs/stats/route.ts</files>
  <action>
    1. src/app/api/logs/route.ts:
       - GET 핸들러: 쿼리 파라미터 파싱 (sources, levels, search, startTime, endTime, limit, offset)
       - LogQueryApiSchema로 검증 (문자열 → Date 변환)
       - logStorage.query() 호출
       - NextResponse.json({ success: true, data: result }) 반환
       - 에러 시 handleApiError 사용

    2. src/app/api/logs/stats/route.ts:
       - GET 핸들러: logStorage.getStats() 호출
       - NextResponse.json({ success: true, data: stats }) 반환

    기존 코드 패턴:
    - @src/app/api/ports/route.ts 참고 (쿼리 파라미터 + Zod 검증)
    - @src/lib/error-handler.ts의 handleApiError 사용
  </action>
  <verify>
    curl "http://localhost:3000/api/logs?limit=10" → JSON 응답
    curl "http://localhost:3000/api/logs/stats" → 통계 JSON 응답
  </verify>
  <done>두 API 엔드포인트가 올바른 JSON 응답을 반환한다</done>
</task>

<task type="auto">
  <name>Task 2: useLogs 훅 구현</name>
  <files>src/hooks/useLogs.ts</files>
  <action>
    @tanstack/react-query 기반 훅 구현:

    1. useLogs 훅:
       - 파라미터: LogQuery 필터 옵션 (sources, levels, search, startTime, endTime, limit, offset)
       - useQuery로 /api/logs 호출
       - 응답 타입: LogQueryResult
       - enabled 조건: 필요 시 비활성화 가능
       - refetchInterval: 선택적 자동 갱신

    2. useLogStats 훅:
       - useQuery로 /api/logs/stats 호출
       - 응답 타입: LogStats
       - staleTime 설정 (통계는 자주 갱신 불필요)

    기존 코드 패턴:
    - @src/hooks/usePorts.ts 참고 (TanStack Query 패턴)
    - @src/hooks/useGitHub.ts 참고 (필터 파라미터 처리)

    쿼리 키 네이밍: ['logs', filters] / ['logs', 'stats']
  </action>
  <verify>
    tsc --noEmit → 타입 에러 없음
    훅이 export되고 컴포넌트에서 import 가능
  </verify>
  <done>useLogs, useLogStats 훅이 정상 동작하고 타입 안전하다</done>
</task>

</tasks>

<verification>
Plan 완료 전 확인:
- [ ] GET /api/logs 엔드포인트가 필터링/페이지네이션 지원
- [ ] GET /api/logs/stats 엔드포인트가 통계 반환
- [ ] useLogs 훅이 로그 조회 및 필터링 가능
- [ ] useLogStats 훅이 통계 조회 가능
- [ ] tsc --noEmit 통과
</verification>

<success_criteria>
- 모든 태스크 완료
- API 엔드포인트 2개 정상 동작
- React Query 훅 2개 export
- 타입 안전성 확보
</success_criteria>

<output>
완료 후 `.planning/phases/37-log-viewer-ui/37-01-SUMMARY.md` 생성
</output>
