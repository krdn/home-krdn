---
phase: 25-test-coverage-expansion
plan: 01
type: tdd
depends_on: []
files_modified: [package.json, vitest.config.ts, src/lib/alertEngine.test.ts]
---

<objective>
Coverage 인프라 설정 및 alertEngine TDD로 핵심 비즈니스 로직 테스트 기반 마련

Purpose: 커버리지 측정 도구를 설정하고, 알림 규칙 엔진의 핵심 로직을 TDD로 검증하여 60% 커버리지 달성의 기초를 구축
Output: @vitest/coverage-v8 설정 완료, alertEngine.test.ts 생성 (TDD 완료)
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/tdd.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/lib/alertEngine.ts
@src/types/alert.ts
@vitest.config.ts

**기존 테스트 패턴:**
@src/lib/utils.test.ts
@src/lib/system.test.ts

**Phase 3 Testing Infrastructure 결정:**
- Vitest 4.x with happy-dom environment
- globals: true (describe/it/expect 전역)
- vi.mock for mocking
- 공동 위치 테스트 (*.test.ts next to source)

**Tech stack:**
- vitest: ^4.0.17
- @testing-library/react: ^16.3.1
- happy-dom: ^20.1.0
</context>

<tasks>

<task type="auto">
  <name>Task 1: @vitest/coverage-v8 설치 및 vitest.config.ts 업데이트</name>
  <files>package.json, vitest.config.ts</files>
  <action>
    1. @vitest/coverage-v8 devDependency 설치:
       npm install -D @vitest/coverage-v8

    2. vitest.config.ts에 coverage 설정 추가:
       - provider: 'v8'
       - reporter: ['text', 'html', 'json-summary']
       - include: ['src/**/*.{ts,tsx}']
       - exclude: ['src/**/*.test.ts', 'src/**/*.d.ts', 'src/types/**']
       - thresholds: { statements: 60, branches: 50, functions: 50, lines: 60 }

    AVOID: jest-based coverage tools (Vitest와 호환성 문제)
    AVOID: istanbul - v8이 더 빠르고 Next.js와 호환성 좋음
  </action>
  <verify>npm run test:coverage -- --run 실행 시 coverage 리포트 생성됨 (에러 없이)</verify>
  <done>coverage 디렉토리에 HTML 리포트 생성, 콘솔에 커버리지 요약 출력</done>
</task>

<task type="auto">
  <name>Task 2: alertEngine TDD - RED phase (실패하는 테스트 작성)</name>
  <files>src/lib/alertEngine.test.ts</files>
  <action>
    alertEngine.ts의 핵심 함수들에 대한 테스트 작성 (실패 예상):

    1. evaluateCondition 테스트:
       - CPU > 80% 조건 평가
       - Memory > 90% 조건 평가
       - 복합 조건 (AND/OR) 평가
       - 경계값 테스트 (exactly 80%)

    2. checkAlertRules 테스트:
       - 단일 규칙 매칭
       - 다중 규칙 평가
       - cooldown 기간 중 중복 알림 방지

    3. formatAlertMessage 테스트:
       - 템플릿 변수 치환
       - 한글 메시지 포맷팅

    테스트 구조:
    ```typescript
    import { describe, it, expect, vi, beforeEach } from 'vitest';
    import { evaluateCondition, checkAlertRules, formatAlertMessage } from './alertEngine';

    describe('alertEngine', () => {
      describe('evaluateCondition', () => {
        it('should return true when CPU exceeds threshold', () => {...});
        // ... more tests
      });
    });
    ```

    AVOID: 구현 세부사항 테스트 (내부 함수 직접 호출)
    WHY: 리팩토링 시 테스트가 깨지지 않도록 public API만 테스트
  </action>
  <verify>npm run test:run -- src/lib/alertEngine.test.ts 실행 시 일부 테스트 FAIL</verify>
  <done>alertEngine.test.ts 파일 생성, 최소 10개 테스트 케이스 작성</done>
</task>

<task type="auto">
  <name>Task 3: alertEngine TDD - GREEN phase (테스트 통과 확인/수정)</name>
  <files>src/lib/alertEngine.ts, src/lib/alertEngine.test.ts</files>
  <action>
    RED phase에서 실패한 테스트를 분석하고:

    1. 테스트가 alertEngine.ts의 실제 구현과 일치하는지 확인
    2. 테스트가 잘못된 경우: 테스트 수정 (구현 기준으로)
    3. 구현이 명세와 다른 경우: 버그 발견 → 문서화

    가능한 시나리오:
    - export 안 된 함수: 테스트 대상 변경 또는 export 추가 필요
    - 함수 시그니처 다름: 테스트 코드 수정
    - 기대값 오류: 실제 동작 기준으로 수정

    AVOID: 테스트 통과만을 위한 무의미한 구현 변경
    WHY: TDD의 목적은 설계 검증, 커버리지 숫자가 아님
  </action>
  <verify>npm run test:run -- src/lib/alertEngine.test.ts 실행 시 모든 테스트 PASS</verify>
  <done>alertEngine.test.ts 모든 테스트 통과, 커버리지 증가 확인</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run test:run` 전체 테스트 통과
- [ ] `npm run test:coverage -- --run` 에러 없이 실행
- [ ] coverage/index.html 파일 생성됨
- [ ] alertEngine.test.ts 10개 이상 테스트 케이스 포함
- [ ] alertEngine.ts 커버리지 50% 이상
</verification>

<success_criteria>
- @vitest/coverage-v8 설치 및 설정 완료
- Coverage 리포트 생성 가능
- alertEngine TDD 사이클 완료 (RED → GREEN)
- 모든 테스트 통과
</success_criteria>

<output>
After completion, create `.planning/phases/25-test-coverage-expansion/25-01-SUMMARY.md`:

# Phase 25 Plan 01: Coverage & Alert Engine TDD Summary

**[실질적 한 줄 요약]**

## Accomplishments
- @vitest/coverage-v8 설치 및 설정
- alertEngine TDD 완료

## Files Created/Modified
- `package.json` - @vitest/coverage-v8 추가
- `vitest.config.ts` - coverage 설정 추가
- `src/lib/alertEngine.test.ts` - TDD 테스트 (신규)

## Decisions Made
[결정 사항]

## Issues Encountered
[이슈]

## Next Step
Ready for 25-02-PLAN.md (Auth & RBAC Tests)
</output>
