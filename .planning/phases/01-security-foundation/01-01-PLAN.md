---
phase: 01-security-foundation
plan: 01
type: execute
depends_on: []
files_modified: [package.json, src/lib/auth.ts, src/types/auth.ts, .env.local, .env.example]
---

<objective>
인증 시스템의 기반 인프라를 구축합니다.

Purpose: JWT 기반 인증을 위한 라이브러리, 타입, 유틸리티 함수를 설정하여 후속 Plan에서 사용할 기반을 마련합니다.
Output: JWT 생성/검증 유틸리티, 인증 타입 정의, 환경 변수 설정
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/ARCHITECTURE.md
@.planning/codebase/CONCERNS.md

**Tech stack:**
- Next.js 16.1.1 (App Router)
- TypeScript 5.x
- No existing auth libraries

**Constraining decisions:**
- Use `jose` library for JWT (not `jsonwebtoken` - CommonJS issues with Edge Runtime)
- Use `bcryptjs` for password hashing (pure JS, no native dependencies)
- httpOnly cookies for JWT storage (XSS protection)
- 15-minute JWT expiry with refresh mechanism

**Key files:**
@src/lib/system.ts (existing library pattern)
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: 인증 의존성 설치</name>
  <files>package.json</files>
  <action>
  `jose`와 `bcryptjs` 패키지를 설치합니다.

  - `jose`: JWT 생성/검증 (Edge Runtime 호환)
  - `bcryptjs`: 비밀번호 해싱 (순수 JavaScript)
  - `@types/bcryptjs`: TypeScript 타입 정의

  jsonwebtoken은 사용하지 않습니다 (Next.js Edge Runtime에서 CommonJS 모듈 이슈 발생).
  </action>
  <verify>npm ls jose bcryptjs 로 설치 확인</verify>
  <done>jose, bcryptjs, @types/bcryptjs가 package.json에 추가됨</done>
</task>

<task type="auto">
  <name>Task 2: 인증 타입 및 JWT 유틸리티 생성</name>
  <files>src/types/auth.ts, src/lib/auth.ts</files>
  <action>
  **src/types/auth.ts:**
  - `User` 인터페이스: id, username, role
  - `JWTPayload` 인터페이스: userId, username, role, iat, exp
  - `AuthResult` 타입: 인증 결과 (success, user, error)

  **src/lib/auth.ts:**
  - `createToken(user: User): Promise<string>` - JWT 생성
  - `verifyToken(token: string): Promise<JWTPayload | null>` - JWT 검증
  - `hashPassword(password: string): Promise<string>` - 비밀번호 해싱
  - `comparePassword(password: string, hash: string): Promise<boolean>` - 비밀번호 비교
  - `getAdminUser(): User` - 환경 변수에서 관리자 정보 로드

  JWT 설정:
  - Algorithm: HS256
  - Expiry: 15분
  - Secret: 환경 변수 `JWT_SECRET`

  단일 관리자 계정 사용 (환경 변수로 설정):
  - `ADMIN_USERNAME`, `ADMIN_PASSWORD_HASH`
  - 홈서버 대시보드는 단일 사용자이므로 DB 없이 환경 변수로 충분
  </action>
  <verify>npx tsc --noEmit 로 타입 에러 없음 확인</verify>
  <done>auth.ts에서 createToken, verifyToken 함수가 export되고, 타입 에러 없음</done>
</task>

<task type="auto">
  <name>Task 3: 환경 변수 설정</name>
  <files>.env.local, .env.example</files>
  <action>
  **.env.example 생성:**
  ```
  # Docker
  DOCKER_HOST=unix:///var/run/docker.sock

  # Authentication
  JWT_SECRET=your-super-secret-jwt-key-change-this-in-production
  ADMIN_USERNAME=admin
  ADMIN_PASSWORD_HASH=$2a$10$... (bcrypt hash of your password)
  ```

  **.env.local 생성 (개발용):**
  - JWT_SECRET: 32자 이상의 랜덤 문자열 생성
  - ADMIN_USERNAME: admin
  - ADMIN_PASSWORD_HASH: "admin123"을 bcrypt로 해싱한 값

  bcrypt 해시 생성 방법을 주석으로 안내:
  `node -e "require('bcryptjs').hash('your-password', 10).then(console.log)"`

  .gitignore에 .env.local이 있는지 확인 (이미 있을 가능성 높음)
  </action>
  <verify>cat .env.example 로 필수 변수들 확인</verify>
  <done>.env.example에 JWT_SECRET, ADMIN_USERNAME, ADMIN_PASSWORD_HASH 포함, .env.local 생성됨</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` 성공 (타입 에러 없음)
- [ ] `npm ls jose bcryptjs` 패키지 설치 확인
- [ ] `.env.example` 파일 존재
- [ ] `src/lib/auth.ts` 파일이 정상 import 가능
</verification>

<success_criteria>
- 모든 tasks 완료
- 타입 에러 없음
- JWT 유틸리티 함수들이 정상 작동
- 환경 변수 문서화 완료
</success_criteria>

<output>
After completion, create `.planning/phases/01-security-foundation/01-01-SUMMARY.md`
</output>
