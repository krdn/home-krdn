---
phase: 26-e2e-test-activation
plan: 01
type: execute
depends_on: []
files_modified: [e2e/fixtures/auth.ts, e2e/login.spec.ts, e2e/auth.spec.ts]
---

<objective>
E2E 인증 Fixture 생성 및 로그인 플로우 테스트로 인증된 사용자 테스트 기반 마련

Purpose: Playwright auth fixture로 인증 상태를 재사용하여 Admin 테스트 활성화 준비
Output: auth fixture 파일, 로그인 플로우 E2E 테스트 완성
</objective>

<context>
@playwright.config.ts
@e2e/auth.spec.ts
@e2e/admin-dashboard.spec.ts
@src/app/login/page.tsx

**현재 상태:**
- 로그인 페이지 존재 (/login)
- auth.spec.ts: 기본 인증 테스트만 존재
- admin-dashboard.spec.ts: 인증 필요 테스트들이 test.skip 상태

**Phase 18 Auth 결정:**
- JWT 기반 인증
- email + password 로그인
- 쿠키에 토큰 저장
</context>

<tasks>

<task type="auto">
  <name>Task 1: Auth Fixture 생성</name>
  <files>e2e/fixtures/auth.ts</files>
  <action>
    Playwright auth fixture 생성하여 인증 상태 재사용:

    1. e2e/fixtures/auth.ts 파일 생성:
       - authenticatedTest fixture 정의
       - storageState를 사용하여 로그인 상태 저장
       - beforeAll에서 로그인 수행

    2. Fixture 구조:
       ```typescript
       import { test as base, expect } from '@playwright/test';

       export const test = base.extend<{}, { workerStorageState: string }>({
         storageState: ({ workerStorageState }, use) => use(workerStorageState),
         workerStorageState: [async ({ browser }, use) => {
           // 로그인 수행 후 storage state 저장
           const page = await browser.newPage({ storageState: undefined });
           await page.goto('/login');
           // 테스트용 계정으로 로그인
           await page.fill('[name="email"]', process.env.TEST_USER_EMAIL || 'admin@example.com');
           await page.fill('[name="password"]', process.env.TEST_USER_PASSWORD || 'admin123');
           await page.click('button[type="submit"]');
           await page.waitForURL('/admin');

           const storageState = await page.context().storageState();
           await page.close();
           await use(JSON.stringify(storageState));
         }, { scope: 'worker' }],
       });

       export { expect } from '@playwright/test';
       ```

    AVOID: 하드코딩된 실제 비밀번호 (환경 변수 사용)
    WHY: CI/CD에서 안전한 시크릿 관리
  </action>
  <verify>TypeScript 컴파일 에러 없음</verify>
  <done>e2e/fixtures/auth.ts 파일 생성 완료</done>
</task>

<task type="auto">
  <name>Task 2: 로그인 플로우 E2E 테스트</name>
  <files>e2e/login.spec.ts</files>
  <action>
    로그인 페이지 E2E 테스트 작성:

    1. 로그인 폼 렌더링 테스트:
       - 이메일/비밀번호 필드 존재
       - 로그인 버튼 존재
       - 회원가입 링크 존재

    2. 로그인 실패 시나리오:
       - 잘못된 이메일 형식
       - 잘못된 비밀번호
       - 빈 필드 제출

    3. 로그인 성공 시나리오 (테스트 계정 필요):
       - 올바른 자격 증명으로 로그인
       - /admin으로 리다이렉트 확인
       - 로그아웃 버튼 표시 확인

    테스트 구조:
    ```typescript
    import { test, expect } from '@playwright/test';

    test.describe('Login Page', () => {
      test.beforeEach(async ({ page }) => {
        await page.goto('/login');
      });

      test('로그인 폼이 올바르게 렌더링됨', async ({ page }) => {
        await expect(page.getByLabel(/이메일|email/i)).toBeVisible();
        await expect(page.getByLabel(/비밀번호|password/i)).toBeVisible();
        await expect(page.getByRole('button', { name: /로그인|login/i })).toBeVisible();
      });

      test('잘못된 비밀번호로 로그인 실패', async ({ page }) => {
        await page.fill('[name="email"]', 'test@test.com');
        await page.fill('[name="password"]', 'wrongpassword');
        await page.click('button[type="submit"]');
        await expect(page.getByText(/실패|error|invalid/i)).toBeVisible();
      });
    });
    ```
  </action>
  <verify>npx playwright test e2e/login.spec.ts --project=chromium 통과</verify>
  <done>login.spec.ts 6개 이상 테스트, 모든 테스트 통과</done>
</task>

<task type="auto">
  <name>Task 3: 기존 auth.spec.ts 확장</name>
  <files>e2e/auth.spec.ts</files>
  <action>
    기존 auth.spec.ts에 인증 관련 추가 테스트:

    1. 회원가입 페이지 접근 테스트:
       - /register 페이지 로딩
       - 필수 필드 존재 확인

    2. 세션 유지 테스트:
       - 로그인 후 새로고침해도 인증 유지
       - 다른 탭에서도 인증 상태 공유

    3. 로그아웃 테스트:
       - 로그아웃 후 /login으로 리다이렉트
       - 보호된 페이지 접근 불가
  </action>
  <verify>npx playwright test e2e/auth.spec.ts --project=chromium 통과</verify>
  <done>auth.spec.ts 확장, 모든 테스트 통과</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] e2e/fixtures/auth.ts 파일 존재
- [ ] e2e/login.spec.ts 6개 이상 테스트
- [ ] e2e/auth.spec.ts 확장 완료
- [ ] `npx playwright test --project=chromium` 모든 테스트 통과
</verification>

<success_criteria>
- Auth fixture로 인증 상태 재사용 가능
- 로그인 플로우 E2E 테스트 완성
- 인증 관련 시나리오 커버리지 확대
</success_criteria>

<output>
After completion, create `.planning/phases/26-e2e-test-activation/26-01-SUMMARY.md`
</output>
