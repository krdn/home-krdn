# 배포 가이드

## 개발 환경

### 요구사항

- Node.js 20+
- npm 10+

### 설치 및 실행

```bash
# 의존성 설치
npm install

# 개발 서버 실행
npm run dev

# 접속: http://localhost:3005
```

### 개발 서버 옵션

```bash
# 특정 포트 지정
npm run dev -- -p 3005

# 네트워크 접속 허용
npm run dev -- -H 0.0.0.0
```

---

## 프로덕션 빌드

### 로컬 빌드

```bash
# 빌드
npm run build

# 프로덕션 서버 실행
npm start
```

### Standalone 빌드

`next.config.ts`에 `output: "standalone"` 설정으로 독립 실행형 빌드가 생성됩니다.

```bash
# 빌드 후 standalone 폴더 확인
ls -la .next/standalone/
```

---

## Docker 배포

### 파일 구조

```
├── Dockerfile              # 멀티스테이지 빌드
├── docker-compose.yml      # Docker Compose 설정
└── deployment/
    └── nginx/
        └── nginx.conf      # Nginx 리버스 프록시 설정
```

### 빌드 및 실행

```bash
# 빌드 및 실행
docker-compose up -d

# 로그 확인
docker-compose logs -f

# 중지
docker-compose down
```

### 접속

```
http://localhost:8082
```

### Dockerfile 설명

```dockerfile
# Stage 1: 의존성 설치
FROM node:20-alpine AS deps
COPY package*.json ./
RUN npm ci

# Stage 2: 빌드
FROM node:20-alpine AS builder
COPY --from=deps /app/node_modules ./node_modules
COPY . .
RUN npm run build

# Stage 3: 프로덕션 실행
FROM node:20-alpine AS runner
COPY --from=builder /app/.next/standalone ./
COPY --from=builder /app/.next/static ./.next/static
CMD ["node", "server.js"]
```

### docker-compose.yml 설명

```yaml
services:
  home-krdn:
    build: .
    mem_limit: 256m
    cpus: 0.5

  nginx:
    image: nginx:alpine
    ports:
      - "8082:80"
    depends_on:
      home-krdn:
        condition: service_healthy
```

---

## 환경 변수

현재 환경 변수는 필요하지 않지만, 향후 API 연동 시 다음 변수가 필요할 수 있습니다:

```bash
# .env.local
DOCKER_HOST=unix:///var/run/docker.sock
```

---

## 리소스 요구사항

### 최소 사양

| 리소스 | 값 |
|--------|-----|
| CPU | 0.5 cores |
| Memory | 256MB |
| Disk | 500MB |

### 권장 사양

| 리소스 | 값 |
|--------|-----|
| CPU | 1 core |
| Memory | 512MB |
| Disk | 1GB |

---

## 헬스체크

### Dockerfile 헬스체크

```dockerfile
HEALTHCHECK --interval=30s --timeout=10s --start-period=10s --retries=3 \
    CMD wget --no-verbose --tries=1 --spider http://localhost:3005/ || exit 1
```

### Nginx 헬스체크 엔드포인트

```
http://localhost:8082/health
```

---

## 트러블슈팅

### 빌드 실패

```bash
# node_modules 삭제 후 재설치
rm -rf node_modules .next
npm install
npm run build
```

### Docker 빌드 실패

```bash
# 캐시 없이 빌드
docker-compose build --no-cache
```

### 포트 충돌

```bash
# 사용 중인 포트 확인
lsof -i :8082

# 다른 포트로 변경 (docker-compose.yml)
ports:
  - "8083:80"  # 8082 → 8083
```
